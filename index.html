<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ripple Impact Animation (CSV Export)</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow: hidden;
        }
        
        .ripple-container {
            position: relative;
            width: 100%;
            height: 600px; /* Expanded height */
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .ripple-center {
            position: relative;
            width: 450px; /* Expanded size */
            height: 450px; /* Expanded size */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Central droplet */
        .droplet {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #2563eb;
            border-radius: 50%;
            z-index: 10;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(37, 99, 235, 0.5);
        }
        
        /* Ripple circles */
        .ripple {
            position: absolute;
            border: 2px solid #3b82f6;
            border-radius: 50%;
            opacity: 0;
            animation: ripple-expand 4s ease-out infinite;
        }
        
        .ripple:nth-child(2) { animation-delay: 0s; }
        .ripple:nth-child(3) { animation-delay: 1s; } /* Adjusted delay */
        .ripple:nth-child(4) { animation-delay: 2s; } /* Adjusted delay */
        .ripple:nth-child(5) { animation-delay: 3s; } /* Adjusted delay */
        
        /* Floating testimonials */
        .testimonial-card {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;
            font-size: 12px;
            color: #333;
            opacity: 0;
            animation: float-testimonial 20s linear infinite; /* Longer, linear animation */
            max-width: 180px; /* Increased max-width */
            text-align: center;
            line-height: 1.4;
            z-index: 8;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            cursor: pointer; /* Indicate interactivity */
            transition: transform 0.3s ease-out; /* Smooth transition for hover */
            display: flex; /* Use flexbox for content alignment */
            flex-direction: column; /* Stack image and text */
            align-items: center;
            justify-content: center;
        }
        
        .testimonial-card:hover {
            transform: scale(1.05); /* Slight scale on hover */
        }

        .testimonial-card img {
            width: 60px; /* Size for profile photos */
            height: 60px;
            border-radius: 50%; /* Circular photos */
            object-fit: cover;
            margin-bottom: 8px;
            border: 2px solid #a8c7fa; /* Light border for photos */
        }

        .testimonial-text {
            font-size: 12px;
            color: #333;
        }

        /* Impact counter overlay */
        .impact-counter {
            position: absolute;
            top: 30px; /* Adjusted position */
            right: 30px; /* Adjusted position */
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px; /* Increased padding */
            border-radius: 30px; /* Adjusted border-radius */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); /* Stronger shadow */
            font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;
            font-size: 16px; /* Increased font size */
            color: #1e40af;
            font-weight: 600;
            backdrop-filter: blur(10px);
            z-index: 15;
        }
        
        .counter-number {
            font-size: 22px; /* Increased font size */
            color: #2563eb;
            font-weight: 700;
        }
        
        /* Loading state */
        .loading {
            opacity: 0.6;
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(37, 99, 235, 0.5);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 30px rgba(37, 99, 235, 0.8);
            }
        }
        
        @keyframes ripple-expand {
            0% {
                width: 0;
                height: 0;
                opacity: 1;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            100% {
                /* Increased size for larger ripple */
                width: 450px; /* Increased from 300px */
                height: 450px; /* Increased from 300px */
                opacity: 0;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
        }
        
        @keyframes float-testimonial {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) rotate(0deg); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(5deg); }
            85% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(355deg); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) rotate(360deg); }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .ripple-container {
                height: 400px; /* Adjusted for mobile */
            }
            
            .ripple-center {
                width: 300px; /* Adjusted for mobile */
                height: 300px; /* Adjusted for mobile */
            }
            
            .impact-counter {
                top: 20px;
                right: 20px;
                padding: 10px 18px;
                font-size: 14px;
            }
            
            .counter-number {
                font-size: 18px;
            }
            
            .testimonial-card {
                max-width: 140px;
                font-size: 11px;
                padding: 8px 12px;
            }
            
            .testimonial-card img {
                width: 50px;
                height: 50px;
            }
            
            @keyframes ripple-expand {
                100% {
                    width: 300px;
                    height: 300px;
                }
            }
        }
    </style>
</head>
<body>
    <div class="ripple-container">
        <div class="ripple-center">
            <!-- Central droplet -->
            <div class="droplet"></div>
            
            <!-- Ripple circles -->
            <div class="ripple"></div>
            <div class="ripple"></div>
            <div class="ripple"></div>
            <div class="ripple"></div>
            
            <!-- Testimonials will be added here dynamically -->
        </div>
        
        <!-- Impact counter -->
        <div class="impact-counter">
            <div>Real-time impacts</div>
            <div class="counter-number" id="momentCounter">Loading...</div>
            <div>moments of care</div>
        </div>
    </div>
    
    <script>
        // =====================================================================
        // IMPORTANT: REPLACE THIS WITH YOUR GOOGLE SHEETS CSV EXPORT URLS
        // Get this from File > Share > Publish to web > CSV
        // Example: const GOOGLE_SHEET_CSV_URLS = ["https://docs.google.com/spreadsheets/d/e/YOUR_SHEET_ID/pub?gid=0&single=true&output=csv"];
        // =====================================================================
        const GOOGLE_SHEET_CSV_URLS = ["https://docs.google.com/spreadsheets/d/e/2PACX-1vTfLQ_eyJRp-MhCe5O-3wmvxV11pMVjCGT8WoRLDHAdc7e4Wpant9wJuxuOSJkXork3FoX28nMznZho/pub?gid=969890899&single=true&output=csv", 
                                       "https://docs.google.com/spreadsheets/d/e/2PACX-1vQng4QMHPZyNfYQqJIyy1GKxQq118HvC7N3t86YHYCJMfRgq33slQsb6L39sapib9CsxnC2oZW3pRhQ/pub?gid=822836489&single=true&output=csv"
                                      ]; 
        
        const counterElement = document.getElementById("momentCounter");
        const rippleCenter = document.querySelector(".ripple-center");
        let allTestimonials = []; // Store all fetched testimonials
        let displayedTestimonials = new Set(); // Keep track of currently displayed testimonials
        const MAX_DISPLAYED_TESTIMONIALS = 5; // Max testimonials visible at once

        // Column names that contain numerical values for the count
        // These columns should ONLY contain numbers (e.g., '14', '29')
        const NUMERICAL_COUNT_COLUMNS = [
            "Do you feel appreciated?",
            "If you're representing a company, how many people in your group feel seen, valued and appreciated? Enter the number of people.",
        ];

        // Function to parse CSV text into an array of objects
        function parseCSV(csvText) {
            const lines = csvText.split(/\r\n|\n/);
            const headers = lines[0].split(',');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const obj = {};
                const currentline = lines[i].split(',');
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j].trim()] = currentline[j] ? currentline[j].trim() : '';
                }
                result.push(obj);
            }
            return result;
        }

        // Function to fetch real-time data from your Google Sheet(s) via CSV export
        async function fetchRealTimeData() {
            try {
                counterElement.textContent = "Loading...";
                counterElement.parentElement.classList.add("loading");
                
                let combinedData = [];
                for (const url of GOOGLE_SHEET_CSV_URLS) {
                    const response = await fetch(url);
                    const csvText = await response.text();
                    const data = parseCSV(csvText);
                    combinedData = combinedData.concat(data);
                }
                
                let totalAppreciatedCount = 0;

                combinedData.forEach(row => {
                    for (const col of NUMERICAL_COUNT_COLUMNS) {
                        const cellValue = row[col];
                        if (cellValue !== undefined && cellValue !== null) {
                            const numValue = parseInt(String(cellValue).trim(), 10);
                            if (!isNaN(numValue) && numValue > 0) {
                                totalAppreciatedCount += numValue;
                            }
                        }
                    }
                });

                counterElement.textContent = totalAppreciatedCount.toLocaleString(); // Display the combined appreciated count

                counterElement.parentElement.classList.remove("loading");

                // Extract testimonials and photos from the 'Feedback' and 'Photo' columns
                // Ensure your Google Sheet has columns named 'Feedback' and 'Photo' (for image URLs)
                allTestimonials = combinedData
                    .filter(row => row.Feedback && row.Feedback.trim() !== "")
                    .map(row => ({ 
                        text: row.Feedback.trim(), 
                        photo: row.Photo && row.Photo.trim() !== "" ? row.Photo.trim() : null 
                    }));

                console.log(`Loaded ${combinedData.length} total rows. Calculated ${totalAppreciatedCount} appreciated moments. Found ${allTestimonials.length} testimonials.`);
                
            } catch (error) {
                console.error("Error fetching data:", error);
                counterElement.textContent = "Error";
                counterElement.parentElement.classList.remove("loading");
            }
        }

        // Function to display floating testimonials
        function showFloatingTestimonial() {
            if (allTestimonials.length === 0) return;

            // Remove testimonials that have completed their animation cycle
            rippleCenter.querySelectorAll(".testimonial-card").forEach(card => {
                const animationDuration = parseFloat(getComputedStyle(card).animationDuration) * 1000; // in ms
                const animationDelay = parseFloat(getComputedStyle(card).animationDelay) * 1000; // in ms
                // Remove card after its animation plus a buffer
                setTimeout(() => {
                    if (card.parentNode) {
                        displayedTestimonials.delete(card.dataset.testimonialId); // Remove from set using ID
                        card.remove();
                    }
                }, animationDuration + animationDelay + 1000); // 1 second buffer
            });

            // Add new testimonials if less than MAX_DISPLAYED_TESTIMONIALS are visible
            while (displayedTestimonials.size < MAX_DISPLAYED_TESTIMONIALS) {
                // Select a random testimonial that is not currently displayed
                let newTestimonial = null;
                const availableTestimonials = allTestimonials.filter(t => !displayedTestimonials.has(t.text));

                if (availableTestimonials.length === 0) {
                    // If all testimonials are currently displayed, or no testimonials available
                    // Reset the set to allow re-displaying after a full cycle
                    if (allTestimonials.length > 0) {
                        displayedTestimonials.clear(); 
                        // Try to pick one again after clearing
                        const randomIndex = Math.floor(Math.random() * allTestimonials.length);
                        newTestimonial = allTestimonials[randomIndex];
                    } else {
                        break; // No testimonials at all
                    }
                } else {
                    const randomIndex = Math.floor(Math.random() * availableTestimonials.length);
                    newTestimonial = availableTestimonials[randomIndex];
                }

                if (newTestimonial) {
                    const card = document.createElement("div");
                    card.className = "testimonial-card";
                    card.dataset.testimonialId = newTestimonial.text; // Use text as a unique ID for the set

                    if (newTestimonial.photo) {
                        const img = document.createElement("img");
                        img.src = newTestimonial.photo;
                        img.alt = "Testimonial Photo";
                        card.appendChild(img);
                    }
                    const textDiv = document.createElement("div");
                    textDiv.className = "testimonial-text";
                    textDiv.textContent = `"${newTestimonial.text}"`; // Add quotes around the testimonial
                    card.appendChild(textDiv);

                    displayedTestimonials.add(newTestimonial.text); // Add to set
                    
                    // Random positioning around the ripple center
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = 100 + Math.random() * 100; // 100-200px from center (adjusted for larger ripple)
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    card.style.left = `calc(50% + ${x}px)`;
                    card.style.top = `calc(50% + ${y}px)`;
                    card.style.transform = "translate(-50%, -50%)";
                    card.style.animationDelay = `${Math.random() * 5}s`; // Random delay for new cards
                    card.style.animationDuration = `${15 + Math.random() * 10}s`; // Vary duration for more natural look

                    rippleCenter.appendChild(card);
                } else {
                    break; // No new unique testimonial found
                }
            }
        }

        // Initialize
        fetchRealTimeData();
        
        // Update data every 24 hours (86,400,000 ms)
        setInterval(fetchRealTimeData, 86400000);
        
        // Show new testimonial every 5 seconds (5000 ms)
        setInterval(showFloatingTestimonial, 5000);
        
        // Show first testimonial after 3 seconds (3000 ms) to allow data to load
        setTimeout(showFloatingTestimonial, 3000);
    </script>
</body>
</html>
